

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Functional Mock-up Unit (FMU) &mdash; OpenModelica Microgrid 2020 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Toolbox Installation and General Remarks" href="Pythoncode.html" />
    <link rel="prev" title="OpenModelica" href="OpenModelica.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> OpenModelica Microgrid
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenModelica.html">OpenModelica</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Functional Mock-up Unit (FMU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pythoncode.html">Toolbox Installation and General Remarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller_tuning.html">Controller Tuning Hints</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/omg.agents.html">omg.agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/omg.aux_ctl.html">omg.aux_ctl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/omg.util.html">omg.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/omg.env.html">omg.env</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/omg.execution.html">omg.execution</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OpenModelica Microgrid</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Functional Mock-up Unit (FMU)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/parts/user_guide/fmu.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="functional-mock-up-unit-fmu">
<h1>Functional Mock-up Unit (FMU)<a class="headerlink" href="#functional-mock-up-unit-fmu" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-fmi-and-fmu">
<h2>What is FMI and FMU?<a class="headerlink" href="#what-is-fmi-and-fmu" title="Permalink to this headline">¶</a></h2>
<p>The Functional Mock-up Interface (<a class="reference external" href="https://fmi-standard.org/">FMI</a>)
is a free standard that defines a container and an interface to exchange
dynamic models using a combination of XML files, binaries and C code
zipped into a single file. The generated files for the exchange are
called Functional Mock-up Units (FMU). The binaries are
platform-specific, so a linux user can´t run a FMU which is created on a
windows machine.</p>
<p>There are two versions of the FMI standard. The OMG toolbox uses <strong>FMI
2.0</strong>. Furthermore, there are two simulation types, co-simulation (CS) and
model exchange (ME). Co-simulation has an included solver in the FMU,
model exchange provides the possibility to use solvers in Python. Due to
a lack of implicit solvers in CS, the OMG toolbox uses <strong>ME</strong>.</p>
</div>
<div class="section" id="create-fmu-s">
<h2>Create FMU´s<a class="headerlink" href="#create-fmu-s" title="Permalink to this headline">¶</a></h2>
<p>The best way to create a FMU for the OMG toolbox is to run the
create_fmu.mos file in the folder “fmu”. Make sure that
<a class="reference external" href="https://openmodelica.org/download/download-windows">OpenModelica</a> is
installed and your latest version of your OpenModelica file grid.mo is in
the same folder.</p>
<p>By running the create_fmu.mos with the command <em>omc</em>, you can create a
FMU of the model <em>network</em> in the grid.mo file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span>\<span class="n">fmu</span><span class="o">&gt;</span> <span class="n">omc</span> <span class="n">create_fmu</span><span class="o">.</span><span class="n">mos</span>
</pre></div>
</div>
<p>Creating FMUs of other models can be generated by changing
<em>grid.network</em> in the last line of the create_fmu.mos to
<em>grid.YourModelName</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OpenModelica</span><span class="o">.</span><span class="n">Scripting</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="s2">&quot;grid.mo&quot;</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>
<span class="n">setCommandLineOptions</span><span class="p">(</span><span class="s2">&quot;-d=newInst&quot;</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>
<span class="n">setCommandLineOptions</span><span class="p">(</span><span class="s2">&quot;-d=initialization&quot;</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>
<span class="n">setCommandLineOptions</span><span class="p">(</span><span class="s2">&quot;--simCodeTarget=Cpp&quot;</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>
<span class="n">setCommandLineOptions</span><span class="p">(</span><span class="s2">&quot;-d=-disableDirectionalDerivatives&quot;</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>
<span class="n">OpenModelica</span><span class="o">.</span><span class="n">Scripting</span><span class="o">.</span><span class="n">translateModelFMU</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">network</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span> <span class="n">fmuType</span> <span class="o">=</span> <span class="s2">&quot;me&quot;</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">()</span>
</pre></div>
</div>
<p>The lines in between are setting flags for the FMU-creation. The
target-language is C++ instead of the default C because of a missing
implementation of directional derivatives in C.</p>
<p>It is possible to create FMUs directly in OpenModelica (File -&gt; Export -&gt;
FMU). Settings for this can be done in Tools -&gt; Options -&gt; Simulation
(Target language and Translation Flags) and Tools -&gt; Options -&gt; FMU for
the Version, type, name and path. This way is not recommended because of
the possibility to miss flags like the initialization. Furthermore,
problems with the providing of directional derivatives occured.</p>
</div>
<div class="section" id="merge-fmus">
<h2>Merge FMUs<a class="headerlink" href="#merge-fmus" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, FMUs only work on the operating system they are
created on. Though, there is a possibility to combine previously
generated FMUs to allow a usage on different platforms.</p>
<p>First, generate FMUs on different platforms from the <strong>same</strong> grid.mo.
Then run the Python file <em>merge</em>_fmus.py. Select the FMUs which
should be combined and choose a target file (does not need to exist
before). The script checks at several points if the FMUs were generated
from the same grid.mo (careful: small changes like parameter variation
might not be detected) and if all FMUs contain binaries for different
platforms.</p>
<p>Annotation for Windows: Sometimes, the script throws an error because in
the temp-folder. The script still works and merges
the fmu. It just needs to be renamed with an “.fmu” at the end and can
directly be used.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Pythoncode.html" class="btn btn-neutral float-right" title="Toolbox Installation and General Remarks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="OpenModelica.html" class="btn btn-neutral float-left" title="OpenModelica" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Bode, Heid, Wallscheid, Weber

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>